\usepackage{environ}
\usepackage{letltxmacro}

\usepackage{dcolumn}
\newcolumntype{d}{D{.}{.}{-1}}
\newcolumntype{Y}{>{\centering\arraybackslash}X}

\hyphenation{CdHgTe HgCdTe CdTe HgTe PbSnSe}

\renewcommand*{\vec}[1]{\mathbf{#1}}
\renewcommand*{\Im}{\operatorname{Im}}
\renewcommand*{\Re}{\operatorname{Re}}
\providecommand*{\abs}[1]{{\left\lvert #1 \right\rvert}}
\DeclareMathOperator{\Tr}{Tr}
\providecommand*{\HgCdTe}{Cd$_{0.7}$Hg$_{0.3}$Te/HgTe/Cd$_{0.7}$Hg$_{0.3}$Te}
\providecommand*{\AIIIBV}{A$^{\rm III}$B$^{\rm V}$}

\renewcommand\minalignsep{0pt}
\NewEnviron{eq}[1]
  {\begin{equation}
    \label{eq:#1}
     \begin{aligned}
       \BODY
     \end{aligned}
    \end{equation}}

\NewEnviron{fig}[3][!t]
  {\begin{figure}[#1]
    \centering
    \includegraphics[width=0.85\linewidth]{#3}
    \caption{\label{fig:#2}\BODY}
   \end{figure}}

\NewEnviron{narrowfig}[3][!t]
  {\begin{figure}[#1]
    \centering
    \includegraphics[width=0.485\linewidth]{#3}
    \caption{\label{fig:#2}\BODY}
   \end{figure}}

%\NewEnviron{widefig}[3][!t]
%  {\begin{figure*}[#1]
%    \centering
%    \includegraphics[width=0.85\linewidth]{#3}
%    \caption{\label{fig:#2}\BODY}
%   \end{figure*}}

\NewEnviron{halffig}[2]
  {\begin{minipage}{.485\linewidth}
    \centering
    \includegraphics[width=0.85\linewidth]{#2}
    \captionof{figure}{\label{fig:#1}\BODY}
   \end{minipage}}

\LetLtxMacro{\oldeqref}{\eqref}
\renewcommand*{\eqref}[1]{\oldeqref{eq:#1}}