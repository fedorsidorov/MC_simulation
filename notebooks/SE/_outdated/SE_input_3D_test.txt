define vertex attribute vmob real

MOBILITY_TENSOR 
vmob  0     0
0     vmob  0
0     0  vmob

PARAMETER lx = 50
PARAMETER ly = 50
PARAMETER z_max = 75.0
PARAMETER angle_surface = 55
PARAMETER angle_mirror = 90
PARAMETER TENS_r = 33.5e-2
PARAMETER TENS_s = -TENS_r*cos((angle_surface)*pi/180)
PARAMETER TENS_m = -TENS_r*cos((angle_mirror)*pi/180)

/*--------------------CONSTRAINTS START--------------------*/
constraint 1
formula: z = 0

constraint 11
formula: x = -lx/2

constraint 22
formula: y = -ly/2

constraint 33
formula: x = lx/2

constraint 44
formula: y = ly/2

constraint 5 nonpositive
formula: z = z_max

/*--------------------CONSTRAINTS END--------------------*/

/*--------------------VERTICES START--------------------*/
vertices
1	-25. -25.   0.
2	-25.   -18.75   0.  
3	-25.  -12.5   0. 
4	-25.    -6.25   0.  
5	-25.   0.   0.
6	-25.     6.25   0.  
7	-25.   12.5   0. 
8	-25.    18.75   0.  
9	-25.  25.   0.
10	-18.75 -25.     0.  
11	-18.75 -18.75   0.  
12	-18.75 -12.5    0.  
13	-18.75  -6.25   0.  
14	-18.75   0.     0.  
15	-18.75   6.25   0.  
16	-18.75  12.5    0.  
17	-18.75  18.75   0.  
18	-18.75  25.     0.  
19	-12.5 -25.    0. 
20	-12.5  -18.75   0.  
21	-12.5 -12.5   0. 
22	-12.5   -6.25   0.  
23	-12.5   0.    0. 
24	-12.5    6.25   0.  
25	-12.5  12.5   0. 
26	-12.5   18.75   0.  
27	-12.5  25.    0. 
28	 -6.25 -25.     0.  
29	 -6.25 -18.75   0.  
30	 -6.25 -12.5    0.  
31	-6.25 -6.25  0.  
32	-6.25  0.    0.  
33	-6.25  6.25  0.  
34	-6.25 12.5   0.  
35	-6.25 18.75  0.  
36	-6.25 25.    0.  
37	  0. -25.   0.
38	  0.   -18.75   0.  
39	  0.  -12.5   0. 
40	 0.   -6.25  0.  
41	0. 0. 0.
42	0.   6.25 0.  
43	 0.  12.5  0. 
44	 0.   18.75  0.  
45	 0. 25.  0.
46	  6.25 -25.     0.  
47	  6.25 -18.75   0.  
48	  6.25 -12.5    0.  
49	 6.25 -6.25  0.  
50	6.25 0.   0.  
51	6.25 6.25 0.  
52	 6.25 12.5   0.  
53	 6.25 18.75  0.  
54	 6.25 25.    0.  
55	 12.5 -25.    0. 
56	 12.5  -18.75   0.  
57	 12.5 -12.5   0. 
58	12.5  -6.25  0.  
59	12.5  0.   0. 
60	12.5   6.25  0.  
61	12.5 12.5  0. 
62	12.5  18.75  0.  
63	12.5 25.   0. 
64	 18.75 -25.     0.  
65	 18.75 -18.75   0.  
66	 18.75 -12.5    0.  
67	18.75 -6.25  0.  
68	18.75  0.    0.  
69	18.75  6.25  0.  
70	18.75 12.5   0.  
71	18.75 18.75  0.  
72	18.75 25.    0.  
73	 25. -25.   0.
74	 25.   -18.75   0.  
75	 25.  -12.5   0. 
76	25.   -6.25  0.  
77	25.  0.  0.
78	25.    6.25  0.  
79	25.  12.5  0. 
80	25.   18.75  0.  
81	25. 25.  0.
82	-25.   -25.    18.75
83	-25.   -18.75  18.75
84	-25.  -12.5  25. 
85	-25.    -6.25  37.5 
86	-25.   0.  75.
87	-25.     6.25  37.5 
88	-25.   12.5  25. 
89	-25.    18.75  18.75
90	-25.    25.    18.75
91	-18.75 -25.    18.75
92	-18.75 -18.75  18.75
93	-18.75 -12.5   25.  
94	-18.75  -6.25  37.5 
95	-18.75   0.    75.  
96	-18.75   6.25  37.5 
97	-18.75  12.5   25.  
98	-18.75  18.75  18.75
99	-18.75  25.    18.75
100	-12.5  -25.    18.75
101	-12.5  -18.75  18.75
102	-12.5 -12.5  25. 
103	-12.5   -6.25  37.5 
104	-12.5   0.   75. 
105	-12.5    6.25  37.5 
106	-12.5  12.5  25. 
107	-12.5   18.75  18.75
108	-12.5   25.    18.75
109	 -6.25 -25.    18.75
110	 -6.25 -18.75  18.75
111	 -6.25 -12.5   25.  
112	-6.25 -6.25 37.5 
113	-6.25  0.   75.  
114	-6.25  6.25 37.5 
115	-6.25 12.5  25.  
116	-6.25 18.75 18.75
117	-6.25 25.   18.75
118	  0.   -25.    18.75
119	  0.   -18.75  18.75
120	  0.  -12.5  25. 
121	 0.   -6.25 37.5 
122	 0.  0. 75.
123	 0.    6.25 37.5 
124	 0.  12.5 25. 
125	 0.   18.75 18.75
126	 0.   25.   18.75
127	  6.25 -25.    18.75
128	  6.25 -18.75  18.75
129	  6.25 -12.5   25.  
130	 6.25 -6.25 37.5 
131	 6.25  0.   75.  
132	 6.25  6.25 37.5 
133	 6.25 12.5  25.  
134	 6.25 18.75 18.75
135	 6.25 25.   18.75
136	 12.5  -25.    18.75
137	 12.5  -18.75  18.75
138	 12.5 -12.5  25. 
139	12.5  -6.25 37.5 
140	12.5  0.  75. 
141	12.5   6.25 37.5 
142	12.5 12.5 25. 
143	12.5  18.75 18.75
144	12.5  25.   18.75
145	 18.75 -25.    18.75
146	 18.75 -18.75  18.75
147	 18.75 -12.5   25.  
148	18.75 -6.25 37.5 
149	18.75  0.   75.  
150	18.75  6.25 37.5 
151	18.75 12.5  25.  
152	18.75 18.75 18.75
153	18.75 25.   18.75
154	 25.   -25.    18.75
155	 25.   -18.75  18.75
156	 25.  -12.5  25. 
157	25.   -6.25 37.5 
158	25.  0. 75.
159	25.    6.25 37.5 
160	25.  12.5 25. 
161	25.   18.75 18.75
162	25.   25.   18.75
/*--------------------VERTICES END--------------------*/

/*--------------------EDGES START--------------------*/
edges
1	 1 10
2	 2 11
3	 3 12
4	 4 13
5	 5 14
6	 6 15
7	 7 16
8	 8 17
9	 9 18
10	10 19
11	11 20
12	12 21
13	13 22
14	14 23
15	15 24
16	16 25
17	17 26
18	18 27
19	19 28
20	20 29
21	21 30
22	22 31
23	23 32
24	24 33
25	25 34
26	26 35
27	27 36
28	28 37
29	29 38
30	30 39
31	31 40
32	32 41
33	33 42
34	34 43
35	35 44
36	36 45
37	37 46
38	38 47
39	39 48
40	40 49
41	41 50
42	42 51
43	43 52
44	44 53
45	45 54
46	46 55
47	47 56
48	48 57
49	49 58
50	50 59
51	51 60
52	52 61
53	53 62
54	54 63
55	55 64
56	56 65
57	57 66
58	58 67
59	59 68
60	60 69
61	61 70
62	62 71
63	63 72
64	64 73
65	65 74
66	66 75
67	67 76
68	68 77
69	69 78
70	70 79
71	71 80
72	72 81
73	1 2
74	2 3
75	3 4
76	4 5
77	5 6
78	6 7
79	7 8
80	8 9
81	10 11
82	11 12
83	12 13
84	13 14
85	14 15
86	15 16
87	16 17
88	17 18
89	19 20
90	20 21
91	21 22
92	22 23
93	23 24
94	24 25
95	25 26
96	26 27
97	28 29
98	29 30
99	30 31
100	31 32
101	32 33
102	33 34
103	34 35
104	35 36
105	37 38
106	38 39
107	39 40
108	40 41
109	41 42
110	42 43
111	43 44
112	44 45
113	46 47
114	47 48
115	48 49
116	49 50
117	50 51
118	51 52
119	52 53
120	53 54
121	55 56
122	56 57
123	57 58
124	58 59
125	59 60
126	60 61
127	61 62
128	62 63
129	64 65
130	65 66
131	66 67
132	67 68
133	68 69
134	69 70
135	70 71
136	71 72
137	73 74
138	74 75
139	75 76
140	76 77
141	77 78
142	78 79
143	79 80
144	80 81
145	82 91
146	83 92
147	84 93
148	85 94
149	86 95
150	87 96
151	88 97
152	89 98
153	90 99
154	 91 100
155	 92 101
156	 93 102
157	 94 103
158	 95 104
159	 96 105
160	 97 106
161	 98 107
162	 99 108
163	100 109
164	101 110
165	102 111
166	103 112
167	104 113
168	105 114
169	106 115
170	107 116
171	108 117
172	109 118
173	110 119
174	111 120
175	112 121
176	113 122
177	114 123
178	115 124
179	116 125
180	117 126
181	118 127
182	119 128
183	120 129
184	121 130
185	122 131
186	123 132
187	124 133
188	125 134
189	126 135
190	127 136
191	128 137
192	129 138
193	130 139
194	131 140
195	132 141
196	133 142
197	134 143
198	135 144
199	136 145
200	137 146
201	138 147
202	139 148
203	140 149
204	141 150
205	142 151
206	143 152
207	144 153
208	145 154
209	146 155
210	147 156
211	148 157
212	149 158
213	150 159
214	151 160
215	152 161
216	153 162
217	82 83
218	83 84
219	84 85
220	85 86
221	86 87
222	87 88
223	88 89
224	89 90
225	91 92
226	92 93
227	93 94
228	94 95
229	95 96
230	96 97
231	97 98
232	98 99
233	100 101
234	101 102
235	102 103
236	103 104
237	104 105
238	105 106
239	106 107
240	107 108
241	109 110
242	110 111
243	111 112
244	112 113
245	113 114
246	114 115
247	115 116
248	116 117
249	118 119
250	119 120
251	120 121
252	121 122
253	122 123
254	123 124
255	124 125
256	125 126
257	127 128
258	128 129
259	129 130
260	130 131
261	131 132
262	132 133
263	133 134
264	134 135
265	136 137
266	137 138
267	138 139
268	139 140
269	140 141
270	141 142
271	142 143
272	143 144
273	145 146
274	146 147
275	147 148
276	148 149
277	149 150
278	150 151
279	151 152
280	152 153
281	154 155
282	155 156
283	156 157
284	157 158
285	158 159
286	159 160
287	160 161
288	161 162
289	 1 82
290	 2 83
291	 3 84
292	 4 85
293	 5 86
294	 6 87
295	 7 88
296	 8 89
297	 9 90
298	10 91
299	18 99
300	 19 100
301	 27 108
302	 28 109
303	 36 117
304	 37 118
305	 45 126
306	 46 127
307	 54 135
308	 55 136
309	 63 144
310	 64 145
311	 72 153
312	 73 154
313	 74 155
314	 75 156
315	 76 157
316	 77 158
317	 78 159
318	 79 160
319	 80 161
320	 81 162
/*--------------------EDGES END--------------------*/

/*--------------------FACES START--------------------*/
faces
1	 73   2 -81  -1
2	 74   3 -82  -2
3	 75   4 -83  -3
4	 76   5 -84  -4
5	 77   6 -85  -5
6	 78   7 -86  -6
7	 79   8 -87  -7
8	 80   9 -88  -8
9	 81  11 -89 -10
10	 82  12 -90 -11
11	 83  13 -91 -12
12	 84  14 -92 -13
13	 85  15 -93 -14
14	 86  16 -94 -15
15	 87  17 -95 -16
16	 88  18 -96 -17
17	 89  20 -97 -19
18	 90  21 -98 -20
19	 91  22 -99 -21
20	  92   23 -100  -22
21	  93   24 -101  -23
22	  94   25 -102  -24
23	  95   26 -103  -25
24	  96   27 -104  -26
25	  97   29 -105  -28
26	  98   30 -106  -29
27	  99   31 -107  -30
28	 100   32 -108  -31
29	 101   33 -109  -32
30	 102   34 -110  -33
31	 103   35 -111  -34
32	 104   36 -112  -35
33	 105   38 -113  -37
34	 106   39 -114  -38
35	 107   40 -115  -39
36	 108   41 -116  -40
37	 109   42 -117  -41
38	 110   43 -118  -42
39	 111   44 -119  -43
40	 112   45 -120  -44
41	 113   47 -121  -46
42	 114   48 -122  -47
43	 115   49 -123  -48
44	 116   50 -124  -49
45	 117   51 -125  -50
46	 118   52 -126  -51
47	 119   53 -127  -52
48	 120   54 -128  -53
49	 121   56 -129  -55
50	 122   57 -130  -56
51	 123   58 -131  -57
52	 124   59 -132  -58
53	 125   60 -133  -59
54	 126   61 -134  -60
55	 127   62 -135  -61
56	 128   63 -136  -62
57	 129   65 -137  -64
58	 130   66 -138  -65
59	 131   67 -139  -66
60	 132   68 -140  -67
61	 133   69 -141  -68
62	 134   70 -142  -69
63	 135   71 -143  -70
64	 136   72 -144  -71
65	 145  225 -146 -217
66	 146  226 -147 -218
67	 147  227 -148 -219
68	 148  228 -149 -220
69	 149  229 -150 -221
70	 150  230 -151 -222
71	 151  231 -152 -223
72	 152  232 -153 -224
73	 154  233 -155 -225
74	 155  234 -156 -226
75	 156  235 -157 -227
76	 157  236 -158 -228
77	 158  237 -159 -229
78	 159  238 -160 -230
79	 160  239 -161 -231
80	 161  240 -162 -232
81	 163  241 -164 -233
82	 164  242 -165 -234
83	 165  243 -166 -235
84	 166  244 -167 -236
85	 167  245 -168 -237
86	 168  246 -169 -238
87	 169  247 -170 -239
88	 170  248 -171 -240
89	 172  249 -173 -241
90	 173  250 -174 -242
91	 174  251 -175 -243
92	 175  252 -176 -244
93	 176  253 -177 -245
94	 177  254 -178 -246
95	 178  255 -179 -247
96	 179  256 -180 -248
97	 181  257 -182 -249
98	 182  258 -183 -250
99	 183  259 -184 -251
100	 184  260 -185 -252
101	 185  261 -186 -253
102	 186  262 -187 -254
103	 187  263 -188 -255
104	 188  264 -189 -256
105	 190  265 -191 -257
106	 191  266 -192 -258
107	 192  267 -193 -259
108	 193  268 -194 -260
109	 194  269 -195 -261
110	 195  270 -196 -262
111	 196  271 -197 -263
112	 197  272 -198 -264
113	 199  273 -200 -265
114	 200  274 -201 -266
115	 201  275 -202 -267
116	 202  276 -203 -268
117	 203  277 -204 -269
118	 204  278 -205 -270
119	 205  279 -206 -271
120	 206  280 -207 -272
121	 208  281 -209 -273
122	 209  282 -210 -274
123	 210  283 -211 -275
124	 211  284 -212 -276
125	 212  285 -213 -277
126	 213  286 -214 -278
127	 214  287 -215 -279
128	 215  288 -216 -280
129	   1  298 -145 -289
130	  10  300 -154 -298
131	  19  302 -163 -300
132	  28  304 -172 -302
133	  37  306 -181 -304
134	  46  308 -190 -306
135	  55  310 -199 -308
136	  64  312 -208 -310
137	 297  153 -299   -9
138	 299  162 -301  -18
139	 301  171 -303  -27
140	 303  180 -305  -36
141	 305  189 -307  -45
142	 307  198 -309  -54
143	 309  207 -311  -63
144	 311  216 -320  -72
145	 289  217 -290  -73
146	 290  218 -291  -74
147	 291  219 -292  -75
148	 292  220 -293  -76
149	 293  221 -294  -77
150	 294  222 -295  -78
151	 295  223 -296  -79
152	 296  224 -297  -80
153	 137  313 -281 -312
154	 138  314 -282 -313
155	 139  315 -283 -314
156	 140  316 -284 -315
157	 141  317 -285 -316
158	 142  318 -286 -317
159	 143  319 -287 -318
160	 144  320 -288 -319
/*--------------------FACES END--------------------*/

/*--------------------BODIES START--------------------*/
bodies
1	1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 	volume 80078.125

/*--------------------BODIES END--------------------*/

/*--------------------SIMULATION START--------------------*/
read

defmob_1 := {foreach vertex vv do {set vv vmob 1}}

loopit := {g50; w 0.5; w 0.5; V}

set_v_constraint_1 := {
	foreach vertex vv do {if vv.z == 0 then set vv constraint 1}
	}

set_v_constraint_5 := {
	foreach vertex vv do {if vv.z == z_max then set vv constraint 5}
	}

set_v_constraints_11_33 := {
	foreach vertex vv do {
		if vv.x = -lx/2 then set vv constraint 11;
		if vv.x = lx/2 then set vv constraint 33;
		}
	}

set_v_constraints_22_44 := {
	foreach vertex vv do {
		if vv.y = -ly/2 then set vv constraint 22;
		if vv.y = ly/2 then set vv constraint 44;
		}
	}

set_e_constraint_1 := {
	foreach edge ee do {
		cnt := 0;
		foreach ee.vertices vv do {
			if vv.z == 0 then cnt := cnt + 1
			};
		if cnt == 2 then set ee constraint 1
		};
	}

set_e_constraint_11_33 := {
	foreach edge ee do {
		cnt := 0;
		foreach ee.vertices vv do {
			if vv.x == -lx/2 then cnt := cnt - 1;
			if vv.x == lx/2 then cnt := cnt + 1
			};
		if cnt == -2 then set ee constraint 11;
		if cnt == 2 then set ee constraint 33
		};
	}

set_e_constraint_22_44 := {
	foreach edge ee do {
		cnt := 0;
		foreach ee.vertices vv do {
			if vv.y == -ly/2 then cnt := cnt - 1;
			if vv.y == ly/2 then cnt := cnt + 1
			};
		if cnt == -2 then set ee constraint 22;
		if cnt == 2 then set ee constraint 44
		};
	}

set_f_tension_resist := {foreach facet ff do {set ff tension TENS_r}}

set_f_tension_surface := {
	foreach facet ff do {
		cnt := 0;
		foreach ff.vertices vv do {
			if vv.z == 0 then cnt := cnt + 1
			};
		if cnt == 3 then set ff tension TENS_s
		}
	}

set_f_tension_mirror := {
	foreach facet ff do {
		cnt := 0;
		foreach ff.vertices vv do {
			if vv.x == -lx/2 then cnt := cnt - 1;
			if vv.x == lx/2 then cnt := cnt + 1
			};
		if abs(cnt) == 3 then set ff tension TENS_m;
		};
	foreach facet ff do {
		cnt := 0;
		foreach ff.vertices vv do {
			if vv.y == -ly/2 then cnt := cnt - 1;
			if vv.y == ly/2 then cnt := cnt + 1
			};
		if abs(cnt) == 3 then set ff tension TENS_m;
		}
	}

color_TENS_m_faces := {set facet color brown where tension == TENS_m}

color_TENS_s_faces := {set facet color cyan where tension == TENS_s}

color_TENS_r_faces := {set facet color yellow where tension == TENS_r}

prepare_surface := {
	set_v_constraint_1;
	set_v_constraints_11_33;
	set_v_constraints_22_44;
	set_e_constraint_1;
	set_e_constraint_11_33;
	set_e_constraint_22_44;
	set_f_tension_resist;
	set_f_tension_surface;
	set_f_tension_mirror;
	color_TENS_m_faces;
	color_TENS_s_faces;
	color_TENS_r_faces;
	area_normalization;
	defmob_1
	}

loopit := {g10; w 0.001; w 0.001; V}

save := {
	foreach vertex do {
		if x < 1 then if x > -1 then printf "%f %f %f\n", x, y, z >> "vlist.txt";
		}
	}

ebash := {
	prepare_surface;
	m 0.0001;
	cnt := 0;
	save;
	printf "%f %f %f\n", total_time, -100., -100. >> "vlist.txt";
	while cnt < 1000 do {
		loopit 5;
		save;
		printf "%f %f %f\n", total_time, -100., -100. >> "vlist.txt";
		cnt := cnt + 1;
		print cnt;
		};
	}
